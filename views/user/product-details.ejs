<%- include("../../views/partials/user/header") %>
<main class="main">
    <!-- Breadcrumb -->
    <div class="page-header">
        <div class="container">
            <nav class="breadcrumb-nav">
                <a href="/">Home</a>
                <span>/</span>
                <a href="/shop">Shop</a>
                <span>/</span>
                <span>Product Detail Page</span>
            </nav>
        </div>
    </div>

    <section class="product-section">
        <div class="container">
            <div class="row">
                <!-- Left Column - Product Images -->
                <div class="col-md-6">
                    <div class="product-gallery">
                        <!-- Main Image with Zoom -->
                        <div class="main-image-container">
                            <div class="image-zoom-wrapper">
                                <img src="/uploads/re-image/<%= product.productImage[0] %>" 
                                     alt="<%= product.productName %>" 
                                     class="main-image"
                                     id="zoomImage">
                                <div class="zoom-lens"></div>
                                <div class="zoom-result"></div>
                            </div>
                            <button class="zoom-btn">
                                <i class="fi-rs-search"></i>
                            </button>
                        </div>
                        
                        <!-- Thumbnail Images -->
                        <div class="thumbnail-container">
                            <% product.productImage.forEach((image, index) => { %>
                                <div class="thumbnail-item <%= index === 0 ? 'active' : '' %>">
                                    <img src="/uploads/re-image/<%= image %>" alt="Thumbnail <%= index + 1 %>">
                                </div>
                            <% }) %>
                        </div>
                    </div>
                </div>

                <!-- Right Column - Product Details -->
                <div class="col-md-6">
                    <div class="product-details">
                        <!-- Product Title -->
                        <h1 class="product-title"><%= product.productName %></h1>

                        <!-- Brand and Reviews -->
                        <div class="product-meta">
                            <div class="brand">
                                Brands: <a href="#"><%= product.brand %></a>
                            </div>
                            <div class="reviews">
                                <div class="stars">
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star-half-alt"></i>
                                </div>
                                <span>(25 reviews)</span>
                            </div>
                        </div>

                        <!-- Price -->
                        <div class="product-price">
                            <span class="current-price">₹<%= product.salePrice %></span>
                            <span class="original-price">₹<%= product.regularPrice %></span>
                            <% if(totalOffer) { %>
                                <span class="discount"><%= totalOffer %>% Offer</span>
                            <% } %>
                        </div>

                        <!-- Description -->
                        <p class="product-description">
                            <%= product.description %>
                        </p>

                        <!-- Features -->
                        <ul class="product-features">
                            <li><i class="fi-rs-crown"></i> 1 Year Brand Warranty</li>
                            <li><i class="fi-rs-refresh"></i> 30 Day Return Policy</li>
                            <li><i class="fi-rs-credit-card"></i> Cash on Delivery available</li>
                        </ul>

                        <!-- Add to Cart Section -->
                        <div class="add-to-cart-section">
                            <div class="quantity-selector">
                                <button class="qty-btn minus">-</button>
                                <input type="number" value="1" min="1" class="qty-input">
                                <button class="qty-btn plus">+</button>
                            </div>
                            <button class="add-to-cart-btn">Add to cart</button>
                            <button class="wishlist-btn">
                                <i class="fi-rs-heart"></i>
                            </button>
                        </div>

                        <!-- Product Meta Information -->
                        <div class="product-meta-info">
                            <div>Stock Code: <span>FWM15VKT</span></div>
                            <div>Tags: <a href="#"><%= category.name %></a></div>
                            <div>Availability: <span class="in-stock"><%= quantity %> Items in Stock</span></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Related Products Section -->
    <% if (relatedProducts && relatedProducts.length > 0) { %>
        <section class="related-products-section">
            <div class="container">
                <h2 class="section-title">Related Products</h2>
                <div class="related-products-slider">
                    <% relatedProducts.forEach(relatedProduct => { %>
                        <div class="product-card">
                            <div class="product-image">
                                <a href="/product/<%= relatedProduct._id %>">
                                    <img src="/uploads/re-image/<%= relatedProduct.productImage[0] %>" 
                                         alt="<%= relatedProduct.productName %>">
                                </a>
                            </div>
                            <div class="product-info">
                                <h3 class="product-name">
                                    <a href="/product/<%= relatedProduct._id %>">
                                        <%= relatedProduct.productName %>
                                    </a>
                                </h3>
                                <div class="product-price">
                                    <span class="current-price">₹<%= relatedProduct.salePrice %></span>
                                    <% if (relatedProduct.regularPrice) { %>
                                        <span class="original-price">₹<%= relatedProduct.regularPrice %></span>
                                    <% } %>
                                </div>
                            </div>
                        </div>
                    <% }) %>
                </div>
            </div>
        </section>
    <% } %>
</main>

<style>
/* Main Styles */
.main {
    padding-top: 20px;
}

.page-header {
    background-color: #f7f8fa;
    padding: 15px 0;
}

.breadcrumb-nav {
    font-size: 14px;
}

.breadcrumb-nav a {
    color: #333;
    text-decoration: none;
}

.breadcrumb-nav span {
    margin: 0 10px;
    color: #999;
}

/* Product Section Styles */
.product-section {
    padding: 40px 0;
}

/* Image Gallery Styles */
.product-gallery {
    position: relative;
}

.main-image-container {
    position: relative;
    background-color: #f7f8fa;
    border-radius: 10px;
    overflow: hidden;
    margin-bottom: 20px;
}

/* Image Zoom Styles */
.image-zoom-wrapper {
    position: relative;
    width: 100%;
    height: 500px;
}

.main-image {
    width: 100%;
    height: 100%;
    object-fit: contain;
}

.zoom-lens {
    position: absolute;
    border: 1px solid #d4d4d4;
    width: 150px;
    height: 150px;
    display: none;
    background: rgba(255, 255, 255, 0.4);
    cursor: crosshair;
}

.zoom-result {
    position: absolute;
    top: 0;
    left: 105%;
    width: 500px;
    height: 500px;
    border: 1px solid #d4d4d4;
    display: none;
    overflow: hidden;
    background-color: #fff;
    z-index: 999;
}

.zoom-btn {
    position: absolute;
    top: 15px;
    right: 15px;
    background: white;
    border: none;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

/* Thumbnail Styles */
.thumbnail-container {
    display: flex;
    gap: 10px;
}

.thumbnail-item {
    width: 80px;
    height: 80px;
    border-radius: 8px;
    overflow: hidden;
    cursor: pointer;
}

.thumbnail-item.active {
    border: 2px solid #3BB77E;
}

.thumbnail-item img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

/* Product Details Styles */
.product-title {
    font-size: 24px;
    margin-bottom: 20px;
    color: #253D4E;
}

.product-meta {
    display: flex;
    justify-content: space-between;
    margin-bottom: 20px;
}

.brand a {
    color: #3BB77E;
    text-decoration: none;
}

.product-price {
    margin-bottom: 20px;
}

.current-price {
    font-size: 32px;
    color: #3BB77E;
    font-weight: bold;
    margin-right: 15px;
}

.original-price {
    color: #999;
    text-decoration: line-through;
}

.discount {
    color: #dc3545;
    margin-left: 15px;
}

/* Features and Cart Section Styles */
.product-features {
    list-style: none;
    padding: 0;
    margin: 20px 0;
}

.product-features li {
    margin-bottom: 10px;
    display: flex;
    align-items: center;
}

.product-features i {
    margin-right: 10px;
    color: #3BB77E;
}

.add-to-cart-section {
    display: flex;
    gap: 15px;
    margin: 30px 0;
}

.quantity-selector {
    display: flex;
    align-items: center;
    border: 1px solid #e5e5e5;
    border-radius: 5px;
}

.qty-btn {
    width: 40px;
    height: 40px;
    border: none;
    background: none;
    cursor: pointer;
}

.qty-input {
    width: 50px;
    text-align: center;
    border: none;
    font-size: 16px;
}

.add-to-cart-btn {
    background-color: #3BB77E;
    color: white;
    border: none;
    padding: 0 30px;
    border-radius: 5px;
    cursor: pointer;
}

.wishlist-btn {
    width: 40px;
    height: 40px;
    border: 1px solid #e5e5e5;
    background: none;
    border-radius: 5px;
    cursor: pointer;
}

/* Related Products Styles */
.related-products-section {
    padding: 60px 0;
    background-color: #f8f9fa;
}

.section-title {
    text-align: center;
    margin-bottom: 40px;
    color: #253D4E;
    font-size: 28px;
}

.related-products-slider {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 30px;
    margin: 0 -15px;
}

.product-card {
    background: #fff;
    border-radius: 10px;
    padding: 15px;
    transition: box-shadow 0.3s ease;
}

.product-card:hover {
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
}

.product-card .product-image {
    position: relative;
    height: 200px;
    margin-bottom: 15px;
}

.product-card .product-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 8px;
}

.product-card .product-name {
    font-size: 16px;
    margin-bottom: 10px;
}

.product-card .product-name a {
    color: #253D4E;
    text-decoration: none;
}

.product-card .product-price {
    display: flex;
    gap: 10px;
    align-items: center;
}

.product-meta-info {
    color: #7E7E7E;
    font-size: 14px;
}

.product-meta-info > div {
    margin-bottom: 10px;
}

.in-stock {
    color: #3BB77E;
}

/* Responsive Styles */
@media (max-width: 768px) {
    .related-products-slider {
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    }
    
    .zoom-result {
        display: none !important;
    }
    
    .image-zoom-wrapper {
        height: 350px;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Quantity selector functionality
    const minusBtn = document.querySelector('.minus');
    const plusBtn = document.querySelector('.plus');
    const qtyInput = document.querySelector('.qty-input');

    minusBtn.addEventListener('click', () => {
        const currentValue = parseInt(qtyInput.value);
        if (currentValue > 1) {
            qtyInput.value = currentValue - 1;
        }
    });

    plusBtn.addEventListener('click', () => {
        const currentValue = parseInt(qtyInput.value);
        qtyInput.value = currentValue + 1;
    });

    // Image Zoom Functionality
    const wrapper = document.querySelector('.image-zoom-wrapper');
    const mainImage = document.querySelector('#zoomImage');
    const lens = document.querySelector('.zoom-lens');
    const result = document.querySelector('.zoom-result');

    mainImage.addEventListener('mouseenter', function() {
        lens.style.display = 'block';
        result.style.display = 'block';
    });

    mainImage.addEventListener('mouseleave', function() {
        lens.style.display = 'none';
        result.style.display = 'none';
    });
    mainImage.addEventListener('mousemove', function(e) {
    let rect = mainImage.getBoundingClientRect();
    let x = e.clientX - rect.left;
    let y = e.clientY - rect.top;
    
    // Calculate position for lens
    let lensWidth = lens.offsetWidth / 2;
    let lensHeight = lens.offsetHeight / 2;
    
    lens.style.left = (x - lensWidth) + 'px';
    lens.style.top = (y - lensHeight) + 'px';
    
    // Calculate zoom ratio
    let fx = result.offsetWidth / lens.offsetWidth;
    let fy = result.offsetHeight / lens.offsetHeight;
    
    // Update result
    result.style.backgroundImage = `url('${mainImage.src}')`;
    result.style.backgroundSize = (mainImage.width * fx) + 'px ' + (mainImage.height * fy) + 'px';
    result.style.backgroundPosition = `-${(x * fx - result.offsetWidth / 2)}px -${(y * fy - result.offsetHeight / 2)}px`;
});

    // Thumbnail switching functionality
    const thumbnails = document.querySelectorAll('.thumbnail-item');
    thumbnails.forEach(thumbnail => {
        thumbnail.addEventListener('click', () => {
            // Remove active class from all thumbnails
            thumbnails.forEach(t => t.classList.remove('active'));
            // Add active class to clicked thumbnail
            thumbnail.classList.add('active');
            // Update main image
            mainImage.src = thumbnail.querySelector('img').src;
        });
    });
});
</script>

<%- include("../../views/partials/user/footer") %>